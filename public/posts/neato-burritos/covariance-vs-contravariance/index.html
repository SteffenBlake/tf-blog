<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>Blog | Technically.fun</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="theme-color" content="#000" />
    <link rel="icon" href="/favicon.ico">
    <link rel="canonical" href="http://localhost:1313/">
    <link href="/css/site.css?dda0a00608" rel="stylesheet">

</head>


<body>
<div id="terminal-root">    
      <p>
#!/bin/bash
#     _____          _           _           _ _          __             
#    /__   \___  ___| |__  _ __ (_) ___ __ _| | |_   _   / _|_   _ _ __  
#      / /\/ _ \/ __| '_ \| '_ \| |/ __/ _` | | | | | | | |_| | | | '_ \ 
#     / / |  __/ (__| | | | | | | (_| (_| | | | |_| |_|  _| |_| | | | |
#     \/   \___|\___|_| |_|_| |_|_|\___\__,_|_|_|\__, (_)_|  \__,_|_| |_|
#               2025 Steffen Blake              |___/                   
  </p>

<h1>Technically Fun</h1>
<h2>Navigation</h2>
<nav>
    <a href="/">1. Home</a>
    <a href="/posts">2. All my posts</a>
    <a href="/about">3. About me</a>
</nav>



    


    <h2>Covariance vs Contravariance within Function Scopes</h2>
    <h3>August 11, 2021 -  Steffen Blake</h3>
    <p>This is a topic I find a lot of C(ish) developers mention offhand. They know it has to do with Generics, inheritance in some way, and In vs Out variables.</p>
<p>But to really dig deep into this topic, we will first need to step into the land of Math. To begin, let’s define two different functions:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">string</span> MakeString&lt;T&gt;(T obj) {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>T2 MakeT2&lt;T1, T2&gt;(T1 obj) {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>The first function, <code>MakeString</code> displays <code>Contravariance</code> in its Generic <code>T</code> variable. The reason for this is it has a <code>T</code> defined as one of its parameters.</p>
<p>If you were to call it like so in a function:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> myStringExcplicit = MakeString&lt;<span style="color:#66d9ef">int</span>&gt;(<span style="color:#ae81ff">5</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> myStringImplicit = MakeString(<span style="color:#ae81ff">5</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>Both calls would compile, and if you are using a linting tool, it may even suggest to remove that <code>&lt;int&gt;</code> call on the first explicit generic. This is because, implicitly speaking, 5 is an integer by default, so the compiler is smart enough to discern that <code>T</code> is actually int specifically here.</p>
<p>Now, lets try and do the same thing but with the second function, MakeT2</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> myStringExcplicit = MakeT2&lt;<span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">string</span>&gt;(<span style="color:#ae81ff">5</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> myStringImplicit = MakeT2(<span style="color:#ae81ff">5</span>);    <span style="color:#75715e">// This won&#39;t compile</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">string</span> myStringImplicit = MakeT2(<span style="color:#ae81ff">5</span>); <span style="color:#75715e">// Not even this will either!</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In this function, we have the <code>T2</code> variable declared as <code>Covarient</code>, which means modifying the parameters passed into the function has no implicit effect on its return value.</p>
<p>This can further be demonstrated with our <code>MakeString</code> function simply by the following code:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>MakeString(<span style="color:#ae81ff">5</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>This will even compile, because of the inherent contract all Functions have in C(ish) languages (and pretty much all other languages too), and that is that a <code>Function</code> cannot see outside of its own scope. Now I know, in C# you can use <code>Reflection</code> and a few tricks to enable seeing outside of a <code>Function</code>, (like if, for example, you wanted to get the name of the class or method the function was called within, you can indeed. But such things should be avoided unless its for logging or whatnot.)</p>
<p>This means <code>Function</code>s have no concept of whether their return was assigned to anything, what it was assigned to, how it was used, etc. This would require knowledge outside the scope of the function, which breaks a core paradigm of logical coding.</p>
<p>However, this has a very annoying side effect, consider the following function:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>TOut DoTheThing&lt;TIn1, TIn2, TIn3, TIn4, TIn5, TIn6, TOut&gt;
</span></span><span style="display:flex;"><span>    (TIn1 in1, TIn2 in2, TIn3 in3, TIn4 in4, TIn5 in5, TIn6 in6) { .... }
</span></span></code></pre></td></tr></table>
</div>
</div><p>Okay first I will say, please avoid making functions like this in the first place, put all those variables in a single class. But lets say that’s not possible here for some crazy reason.</p>
<p>Well the thing about C# (and many other generic based languages) is as soon as you have even one <code>Covarient</code> variable in the scope of your function, you have to declare all of the generics of your function explicitly, even all your Contravarient ones!</p>
<p>In other words, you’d have to call it like this:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> myThing = DoTheThing&lt;<span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">int</span>&gt;(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>);
</span></span><span style="display:flex;"><span>Console.WriteLine(<span style="color:#e6db74">$&#34;{myThing}&#34;&#34;);
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Even though in this case the compiler should know that <code>T1</code> through <code>T6</code> are ints, because its not sure about that seventh <code>Covarient</code> return variable, you have to declare them all.</p>
<p>But fear not, for in times like these, we have one Hail Mary to call upon in many of these same languages, the powerful <code>out</code> variable!</p>
<p>If we were to declare the signature of our function like so instead:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> DoTheThing&lt;TIn1, TIn2, TIn3, TIn4, TIn5, TIn6, TOut&gt;
</span></span><span style="display:flex;"><span>    (TIn1 in1, TIn2 in2, TIn3 in3, TIn4 in4, TIn5 in5, TIn6 in6, <span style="color:#66d9ef">out</span> TOut out1) { .... }
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then we will in fact be able to safely call it like so, both ways assuming you are post C#7:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Pre C#7 inline out vars:</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> out1;
</span></span><span style="display:flex;"><span>DoTheThing(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#66d9ef">out</span> out1);
</span></span><span style="display:flex;"><span>Console.WriteLine(<span style="color:#e6db74">$&#34;{out1}&#34;&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">// Post C#7 shortcut (very handy here)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DoTheThing(1, 2, 3, 4, 5, 6, out int out2);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Console.WriteLine($&#34;</span>{out2}<span style="color:#e6db74">&#34;&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is because unlike the return value of the function, <code>out</code> vars are explicitly <code>Contravarient</code>, in fact if you have used them before, the compiler requires you to assign something to the variable (thus initializing it explicitly as the type defined, even if generic) before the function exits.</p>
<p>Notice above that these out var functions don’t have their generics explicitly defined anymore</p>
<p>This is because they no longer have any <code>Covarient</code> variables, which allows this.</p>
<p>A very powerful and handy tool, if you ask me, especially when combined with guard cases.</p>









    
    

    
    

</div>

<div id="visual-container"></div>


  <script src="/js/site.js?ff68167c07"></script>


</body>


</html>
